<form [formGroup]="studentForm" (ngSubmit)="submitForm()">
  <mat-form-field appearance="fill">
    <mat-label>Name</mat-label>
    <input matInput formControlName="name" />
  </mat-form-field>

  <mat-radio-group formControlName="gender">
    <mat-radio-button value="Male">Male</mat-radio-button>
    <mat-radio-button value="Female">Female</mat-radio-button>
  </mat-radio-group>

  <mat-form-field appearance="fill">
    <mat-label>Course</mat-label>
    <mat-select formControlName="course" required>
      @for (course of courses; track $index) {
        <mat-option [value]="course">{{ course }}</mat-option>
      }
    </mat-select>
    @if (studentForm.get('course')?.hasError('required')) {
      <mat-error>Course is required</mat-error>
    }
  </mat-form-field>

  <div>
    <label>Hobbies:</label>
    @for (hobby of hobbies; track $index) {
      <span>
        <mat-checkbox
          [checked]="(studentForm.get('hobbies')?.value || []).includes(hobby)"
          (change)="hobbyCheckboxSelection($event.checked, hobby)">
          {{ hobby }}
        </mat-checkbox>
      </span>
    }
  </div>

  <mat-form-field appearance="fill">
    <mat-label>City</mat-label>
    <input matInput formControlName="city" [matAutocomplete]="auto">
    <mat-autocomplete #auto="matAutocomplete" (optionSelected)="onCitySelected($event)">
      @for (option of filteredOptions | async; track $index) {
        <mat-option [value]="option">{{ option }}</mat-option>
      }
    </mat-autocomplete>
    @if (studentForm.get('city')?.hasError('required')) {
      <mat-error>City is required</mat-error>
    }
  </mat-form-field>

  <button mat-raised-button color="primary" [disabled]="studentForm.invalid">{{ editingIndex >= 0 ? 'Update' : 'Submit' }}</button>
</form>

<mat-table [dataSource]="gridData" class="mat-elevation-z8">
  @for (column of gridColumns; track $index) {
    @if ($last) {
      <ng-container matColumnDef="actions">
        <mat-header-cell *matHeaderCellDef>Actions</mat-header-cell>
        <mat-cell *matCellDef="let student; let i = index">
          <button mat-icon-button (click)="editStudent(i)">
            <mat-icon>edit</mat-icon>
          </button>
          <button mat-icon-button (click)="deleteStudent(i)">
            <mat-icon>delete</mat-icon>
          </button>
        </mat-cell>
      </ng-container>
    } @else {
      <ng-container [matColumnDef]="column">
        <mat-header-cell *matHeaderCellDef>{{column}}</mat-header-cell>
        <mat-cell *matCellDef="let student">{{ student[column] }}</mat-cell>
      </ng-container>
    }
  }
  <mat-header-row *matHeaderRowDef="gridColumns"></mat-header-row>
  <mat-row *matRowDef="let row; columns: gridColumns"></mat-row>
</mat-table>
